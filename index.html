<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lixana's Birthday Celebration</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Montserrat:wght@300;400;500;600;700&family=Italiana&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#4a5d52; --ink-2:#5a6d61;
      --mauve:#9b85ac; --mint:#88c0a4; --mint-2:#7fb098;
      --mango:#f4a261; --coral:#e76f51;
      --bg1:#fef6f3; --bg2:#f5e8e4; --bg3:#e8ddd5; --bg4:#dfd5ce; --bg5:#f3ebe7;
      --card:#ffffff; --ring:rgba(0,0,0,.08);
      --shadow:0 10px 40px rgba(244,162,97,.10), 0 2px 10px rgba(136,192,164,.10);
      --radius:20px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 25%,var(--bg3) 50%,var(--bg4) 75%,var(--bg5) 100%);
      overflow-x:hidden;
    }

    /* ===== Floating graffiti/confetti (z-index 0 so it sits behind content) ===== */
    .graffiti-bg{position:fixed;inset:0;pointer-events:none;z-index:0}
    .graffiti-element{position:absolute;font-size:2rem;opacity:.18;animation:float-rotate 15s ease-in-out infinite}
    @keyframes float-rotate{
      0%,100%{transform:translateY(0) rotate(0deg) scale(1);opacity:.14}
      25%{transform:translateY(-26px) rotate(90deg) scale(1.1);opacity:.22}
      50%{transform:translateY(18px) rotate(180deg) scale(.93);opacity:.16}
      75%{transform:translateY(-10px) rotate(270deg) scale(1.05);opacity:.20}
    }
    /* soft watercolor blobs */
    .watercolor{position:absolute;border-radius:50%;filter:blur(40px);opacity:.15;animation:pulse-move 8s ease-in-out infinite;z-index:0}
    .watercolor1{width:300px;height:300px;background:var(--mango);top:10%;right:5%}
    .watercolor2{width:250px;height:250px;background:var(--mauve);bottom:20%;left:10%;animation-delay:2s}
    .watercolor3{width:200px;height:200px;background:var(--mint);top:50%;right:20%;animation-delay:4s}
    @keyframes pulse-move{
      0%,100%{transform:translate(0,0) scale(1);opacity:.15}
      50%{transform:translate(20px,-20px) scale(1.2);opacity:.24}
    }
    /* bunting */
    .bunting{position:fixed;top:80px;left:0;width:100%;height:100px;z-index:1;pointer-events:none}
    .bunting-flag{position:absolute;width:0;height:0;border-left:30px solid transparent;border-right:30px solid transparent;animation:sway 3s ease-in-out infinite}
    @keyframes sway{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}

    /* Nav is above background */
    nav{
      position:relative;z-index:3;padding:1.25rem 2rem;
      display:flex;justify-content:space-between;align-items:center;
      background:rgba(255,255,255,.7);backdrop-filter:blur(10px);border-bottom:2px solid rgba(244,162,97,.2)
    }
    .logo{font-family:'Italiana',serif;font-size:1.85rem;letter-spacing:2px;background:linear-gradient(135deg,var(--mango),var(--coral));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .nav-links{display:flex;gap:2rem;align-items:center}
    .nav-links a{color:var(--mint);text-decoration:none;font-weight:600;font-size:.92rem;letter-spacing:1px;position:relative;text-transform:uppercase}
    .nav-links a::after{content:'';position:absolute;bottom:-6px;left:0;width:0;height:2px;background:linear-gradient(90deg,var(--mango),var(--coral));transition:width .3s}
    .nav-links a:hover::after{width:100%}
    .lang-buttons{display:flex;border:2px solid var(--mint);border-radius:25px;overflow:hidden}
    .lang-btn{padding:.45rem 1rem;border:0;background:transparent;color:var(--mint);font-weight:700;letter-spacing:1px;cursor:pointer}
    .lang-btn.active{background:linear-gradient(135deg,var(--mint),var(--mint-2));color:#fff}

    .container{max-width:1300px;margin:2.25rem auto;padding:0 1rem;position:relative;z-index:2}
    .main-card{
      background:rgba(255,255,255,.95);border-radius:20px;padding:2rem 2rem 2.25rem;
      box-shadow:var(--shadow);
      display:grid;grid-template-columns:1.15fr .85fr;gap:3rem;align-items:center;position:relative
    }
    @media (max-width:980px){.main-card{grid-template-columns:1fr;gap:2rem}}

    /* Cake sparkler */
    .cake-decoration{position:absolute;top:-46px;right:72px;width:80px;height:100px;z-index:4}
    .cake{position:relative;width:60px;height:60px;background:linear-gradient(180deg,var(--mango),var(--coral));border-radius:10px;margin:20px auto 0;box-shadow:0 5px 15px rgba(244,162,97,.3)}
    .cake::before{content:'';position:absolute;top:-10px;left:50%;transform:translateX(-50%);width:50px;height:20px;background:#fff;border-radius:50%;box-shadow:inset 0 2px 5px rgba(0,0,0,.1)}
    .sparkler{position:absolute;top:-40px;left:50%;transform:translateX(-50%);width:2px;height:30px;background:#8b7355}
    .spark{position:absolute;top:-5px;left:50%;transform:translateX(-50%);width:20px;height:20px;animation:sparkle .5s ease-in-out infinite}
    .spark::before,.spark::after{content:'✦';position:absolute;color:#ffd700;font-size:1.2rem;animation:twinkle .3s ease-in-out infinite alternate}
    .spark::before{top:-5px;left:-10px;animation-delay:.1s}
    .spark::after{top:-5px;right:-10px;animation-delay:.2s}
    @keyframes sparkle{0%,100%{opacity:1;transform:translateX(-50%) scale(1)}50%{opacity:.8;transform:translateX(-50%) scale(1.2)}}
    @keyframes twinkle{0%{opacity:.5;transform:rotate(0) scale(.8)}100%{opacity:1;transform:rotate(180deg) scale(1.2)}}

    .celebrate-text{font-size:.9rem;font-weight:700;color:var(--mauve);margin-bottom:1rem;letter-spacing:3px;text-transform:uppercase;display:flex;align-items:center;gap:1rem}
    .celebrate-text::before,.celebrate-text::after{content:'';height:2px;width:26px;background:linear-gradient(90deg,var(--mauve),var(--mango))}
    h1{font-family:'Cormorant Garamond',serif;font-size:3.4rem;font-weight:400;color:var(--ink);margin-bottom:1.1rem;line-height:1.08}
    h1 span{font-style:italic;font-weight:600;background:linear-gradient(135deg,var(--mango),var(--coral));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .subtitle{font-weight:400;font-size:1.15rem;color:var(--ink-2);line-height:1.75;margin-bottom:1.75rem}
    .subtitle .emphasis{font-weight:800;font-size:1.12rem;background:linear-gradient(135deg,var(--coral),var(--mango));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-transform:uppercase;letter-spacing:1px}
    .subtitle .excitement{font-weight:700;color:var(--mint);font-style:italic}
    .phone-section{margin-bottom:1.6rem;padding:1rem;background:linear-gradient(135deg,rgba(136,192,164,.12),rgba(244,162,97,.12));border-radius:14px;border-left:4px solid var(--mint);position:relative}
    .phone-section::before{content:'☎';position:absolute;right:16px;top:50%;transform:translateY(-50%);font-size:2.4rem;opacity:.12;color:var(--mango)}
    .phone-label{font-size:.78rem;text-transform:uppercase;letter-spacing:2px;color:var(--mint);margin-bottom:.35rem;font-weight:800}
    .phone-number{font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,var(--mint),var(--mango));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:1px}
    .action-buttons{display:flex;gap:.75rem;flex-wrap:wrap}
    .btn{padding:1rem 1.9rem;border:2px solid;font-size:.9rem;font-weight:800;letter-spacing:1.4px;text-transform:uppercase;cursor:pointer;border-radius:999px;transition:.25s;position:relative}
    .btn-call{background:linear-gradient(135deg,var(--mint),var(--mint-2));color:#fff;border-color:transparent;box-shadow:0 5px 20px rgba(136,192,164,.30)}
    .btn-call:hover{transform:translateY(-2px);box-shadow:0 7px 25px rgba(136,192,164,.40)}
    .btn-text{background:#fff;color:var(--mango);border-color:var(--mango)}
    .btn-text:hover{background:rgba(244,162,97,.10);transform:translateY(-2px);box-shadow:0 5px 20px rgba(244,162,97,.20)}
    .btn-message{background:#fff;color:var(--mauve);border-color:var(--mauve)}
    .btn-message:hover{background:rgba(155,133,172,.10);transform:translateY(-2px);box-shadow:0 5px 20px rgba(155,133,172,.20)}
    .btn.loading{opacity:.7;pointer-events:none}

    .photo-container{padding:1.25rem;background:linear-gradient(135deg,rgba(155,133,172,.06),rgba(244,162,97,.06));border-radius:18px;box-shadow:0 5px 20px rgba(0,0,0,.05)}
    .photo-frame{background:#fff;padding:.8rem;border-radius:14px;box-shadow:inset 0 2px 10px rgba(244,162,97,.10)}
    .main-photo{width:100%;aspect-ratio:16/10;border-radius:10px;overflow:hidden;position:relative}
    .main-photo img{width:100%;height:100%;object-fit:cover;display:block}
    .photo-thumbnails{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;margin-top:.65rem}
    .thumb{aspect-ratio:16/10;border:2px solid rgba(244,162,97,.2);border-radius:8px;overflow:hidden;cursor:pointer;transition:.2s;background:#fff}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb:hover{transform:scale(1.03);box-shadow:0 5px 15px rgba(136,192,164,.25)}
    .thumb[aria-current="true"]{outline:3px solid var(--mint)}

    .guest-wrap{max-width:1300px;margin:1.4rem auto;padding:0 1rem;position:relative;z-index:2}
    .guest-title{font-family:'Cormorant Garamond',serif;font-size:2.2rem;margin:.8rem 0 1rem}
    .status{color:#7b7b7b;margin:.2rem 0 .8rem}
    .cards{display:grid;grid-template-columns:repeat(2,minmax(280px,1fr));gap:.9rem}
    @media (max-width:980px){.cards{grid-template-columns:1fr}}
    .gcard{background:#fff;border:1.5px solid var(--ring);border-radius:12px;padding:12px}
    .ghead{display:flex;justify-content:space-between;gap:8px;margin-bottom:.25rem}
    .gname{font-weight:800}
    .gwhen{color:#888;font-size:.9rem}
    .gtext{white-space:pre-wrap;line-height:1.45}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:10}
    .overlay[open]{display:flex}
    .modal{background:#fff;width:min(680px,92vw);border-radius:16px;box-shadow:var(--shadow);padding:18px;border:1.5px solid var(--ring)}
    .modal header{display:flex;align-items:center;justify-content:space-between}
    .modal h3{font-family:'Cormorant Garamond',serif;font-size:1.8rem}
    form .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:.6rem}
    @media (max-width:640px){form .row{grid-template-columns:1fr}}
    label{font-weight:700;display:block;margin:.6rem 0 .25rem}
    input[type="text"], textarea{width:100%;padding:.75rem .9rem;border-radius:10px;border:2px solid #ccc;font:inherit;outline-color:var(--mango);background:#fffdfd}
    textarea{min-height:120px;resize:vertical}
    .modal .actions{display:flex;gap:.6rem;margin-top:.65rem}
    .btn-close{background:#fff;color:#444;border:2px solid #ddd}
  </style>
</head>
<body>
  <!-- Floating graffiti / watercolor -->
  <div class="graffiti-bg">
    <div class="graffiti-element" style="top:15%;left:10%;color:var(--mango);">◈</div>
    <div class="graffiti-element" style="top:25%;right:15%;animation-delay:2s;color:var(--mint);">◆</div>
    <div class="graffiti-element" style="bottom:30%;left:20%;animation-delay:4s;color:var(--mauve);">◇</div>
    <div class="graffiti-element" style="top:60%;right:25%;animation-delay:1s;color:var(--coral);">◈</div>
    <div class="graffiti-element" style="bottom:15%;right:10%;animation-delay:3s;color:var(--mint);">✦</div>
    <div class="graffiti-element" style="top:40%;left:5%;animation-delay:5s;color:var(--mango);">◉</div>
  </div>
  <div class="watercolor watercolor1"></div>
  <div class="watercolor watercolor2"></div>
  <div class="watercolor watercolor3"></div>
  <div class="bunting">
    <div class="bunting-flag" style="border-bottom:50px solid var(--mango); left:5%"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--mint); left:15%; animation-delay:.2s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--mauve); left:25%; animation-delay:.4s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--coral); left:35%; animation-delay:.6s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--mango); left:45%; animation-delay:.8s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--mint); left:55%; animation-delay:1s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--mauve); left:65%; animation-delay:1.2s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--coral); left:75%; animation-delay:1.4s"></div>
    <div class="bunting-flag" style="border-bottom:50px solid var(--mango); left:85%; animation-delay:1.6s"></div>
  </div>

  <!-- Nav -->
  <nav>
    <div class="logo">Lixana's Birthday</div>
    <div class="nav-links">
      <a href="#top">Home</a>
      <a href="#guestbook">Guestbook</a>
      <div class="lang-buttons">
        <button class="lang-btn active" id="btnEN">EN</button>
        <button class="lang-btn" id="btnES">ES</button>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <div class="container" id="top">
    <div class="main-card">
      <div class="cake-decoration">
        <div class="cake"><div class="sparkler"><div class="spark"></div></div></div>
      </div>

      <div>
        <div class="celebrate-text">Come celebrate with us</div>
        <h1><span>Call or Text</span> Lixana</h1>
        <div class="subtitle">
          <span class="emphasis">WISH</span> her a happy birthday!<br/>
          <span class="excitement">It would mean so much!</span>
        </div>

        <div class="phone-section">
          <div class="phone-label">Contact number</div>
          <div class="phone-number">347-647-9499</div>
        </div>

        <div class="action-buttons">
          <a class="btn btn-call" href="tel:+13476479499">Call</a>
          <a class="btn btn-text" href="sms:+13476479499">Text</a>
          <button class="btn btn-message" id="openModal" type="button">Leave Message</button>
        </div>
      </div>

      <!-- Gallery -->
      <aside>
        <div class="photo-container">
          <div class="photo-frame">
            <figure class="main-photo">
              <img id="hero" src="img/photo1.jpg" alt="Lixana photo" loading="eager"/>
            </figure>
            <div class="photo-thumbnails" id="thumbs">
              <button class="thumb" aria-current="true"><img src="img/photo1-thumb.jpg" alt="Photo 1 thumbnail" loading="lazy"/></button>
              <button class="thumb"><img src="img/photo2-thumb.jpg" alt="Photo 2 thumbnail" loading="lazy"/></button>
              <button class="thumb"><img src="img/photo3-thumb.jpg" alt="Photo 3 thumbnail" loading="lazy"/></button>
              <button class="thumb"><img src="img/photo4-thumb.jpg" alt="Photo 4 thumbnail" loading="lazy"/></button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Guestbook -->
  <div class="guest-wrap" id="guestbook">
    <h2 class="guest-title">Messages for Lixana</h2>
    <div id="status" class="status">Loading messages…</div>
    <div id="cards" class="cards" aria-live="polite"></div>
    <div style="display:flex;justify-content:center;margin:12px 0 18px">
      <button class="btn btn-message" id="openModal2" type="button">Leave Message</button>
    </div>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="dialogTitle">
    <div class="modal">
      <header>
        <h3 id="dialogTitle">Leave a message</h3>
        <button id="closeModal" class="btn btn-close" type="button">Close</button>
      </header>
      <form id="form">
        <div class="row">
          <div>
            <label for="name">Your name</label>
            <input id="name" name="name" type="text" placeholder="Jane Doe" required />
          </div>
          <div>
            <label for="contact">Contact (optional)</label>
            <input id="contact" name="contact" type="text" placeholder="phone or email" />
          </div>
        </div>
        <label for="message">Your message</label>
        <textarea id="message" name="message" placeholder="Write something sweet…" required></textarea>
        <div class="actions">
          <button class="btn btn-message" type="submit" id="submitBtn">Post message</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Supabase + App -->
  <script type="module">
    /* ===== CONFIG (update if you change project) ===== */
    const SUPABASE_URL = "https://dtxjzcufdjivbaurwgal.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0eGp6Y3VmZGppdmJhdXJ3Z2FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMTMyNzAsImV4cCI6MjA3MDg4OTI3MH0.YVdvxrg_WOvWvftB4vNXzyj6rt2kabGLksDr_mDVyVs";
    const TABLE = "messages";

    /* ===== Gallery (auto-rotate with pause on interaction) ===== */
    const hero = document.getElementById('hero');
    const thumbs = Array.from(document.querySelectorAll('.thumb'));
    const sources = ["img/photo1.jpg","img/photo2.jpg","img/photo3.jpg","img/photo4.jpg"];
    let idx = 0, timer = null, pause = false;

    function show(i){
      idx = (i + sources.length) % sources.length;
      hero.src = sources[idx];
      hero.alt = "Photo " + (idx+1);
      thumbs.forEach(t=>t.removeAttribute('aria-current'));
      thumbs[idx].setAttribute('aria-current','true');
    }
    thumbs.forEach((b,i)=>b.addEventListener('click', ()=>{ pause = true; show(i); setTimeout(()=>pause=false, 6000);}));
    hero.addEventListener('mouseenter', ()=>pause = true);
    hero.addEventListener('mouseleave', ()=>pause = false);
    show(0); timer = setInterval(()=>{ if(!pause) show(idx+1); }, 4200);

    /* ===== Modal ===== */
    const overlay = document.getElementById('overlay');
    document.getElementById('openModal').addEventListener('click', ()=>overlay.setAttribute('open',''));
    document.getElementById('openModal2').addEventListener('click', ()=>overlay.setAttribute('open',''));
    document.getElementById('closeModal').addEventListener('click', ()=>overlay.removeAttribute('open'));
    overlay.addEventListener('click', e=>{ if(e.target===overlay) overlay.removeAttribute('open'); });

    /* ===== Guestbook (Supabase with clear error text + local fallback) ===== */
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    const statusEl = document.getElementById('status');
    const cardsEl  = document.getElementById('cards');
    const form     = document.getElementById('form');
    const submitBtn= document.getElementById('submitBtn');

    const fmt = ts => new Date(ts).toLocaleString([], {dateStyle:'medium', timeStyle:'short'});
    const sanitize = s => String(s||'').replace(/[<>]/g,'');

    function render(list){
      list.sort((a,b)=> new Date(b.time) - new Date(a.time));
      cardsEl.innerHTML = list.length ? list.map(m => `
        <article class="gcard">
          <div class="ghead">
            <div class="gname">${sanitize(m.name) || 'Anonymous'}</div>
            <div class="gwhen">${fmt(m.time)}${m.contact ? ' • '+sanitize(m.contact):''}</div>
          </div>
          <div class="gtext">${sanitize(m.text)}</div>
        </article>
      `).join('') : `<article class="gcard">Be the first to leave a message! 🎉</article>`;
    }

    function setStatus(msg){ statusEl.textContent = msg; }

    async function fetchMessagesSupabase(){
      // Try ordering by "time" (our intended column). If that errors, try "created_at".
      let res = await supabase.from(TABLE).select("*").order("time", { ascending:false }).limit(200);
      if(res.error){
        // Second attempt in case the column is named created_at
        res = await supabase.from(TABLE).select("*").order("created_at", { ascending:false }).limit(200);
        if(res.error) throw res.error;
      }
      return res.data || [];
    }

    function fetchMessagesLocal(){
      try{
        const raw = localStorage.getItem('guestbook_local') || "[]";
        return JSON.parse(raw);
      }catch{ return []; }
    }
    function saveMessageLocal(m){
      const list = fetchMessagesLocal();
      list.push(m);
      localStorage.setItem('guestbook_local', JSON.stringify(list));
    }

    async function load(){
      try{
        setStatus("Loading messages…");
        const list = await fetchMessagesSupabase();
        render(list);
        setStatus("Live guestbook enabled via Supabase.");
      }catch(err){
        console.error("Supabase load error:", err);
        setStatus("Could not load messages (using local-only guestbook).");
        render(fetchMessagesLocal());
      }
    }
    await load();

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const entry = {
        name: (form.elements['name']?.value || '').trim(),
        contact: (form.elements['contact']?.value || '').trim(),
        text: (form.elements['message']?.value || '').trim(),
        time: new Date().toISOString()
      };
      if(!entry.text) return;
      submitBtn.classList.add('loading');

      try{
        const { error } = await supabase.from(TABLE).insert(entry);
        if(error) throw error;
        // Re-fetch from backend so it appears immediately
        render(await fetchMessagesSupabase());
        setStatus("Live guestbook enabled via Supabase.");
      }catch(err){
        console.warn("Post to Supabase failed, storing locally:", err);
        saveMessageLocal(entry);
        render(fetchMessagesLocal());
        setStatus("Posted locally (backend not reachable).");
      }finally{
        form.reset();
        overlay.removeAttribute('open');
        submitBtn.classList.remove('loading');
        location.hash = '#guestbook';
      }
    });
  </script>
</body>
</html>
